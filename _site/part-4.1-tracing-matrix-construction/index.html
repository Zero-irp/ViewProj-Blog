<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Part 4.1: Tracing the Matrix Construction Path | Reversing The ViewProjection Matrix</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Part 4.1: Tracing the Matrix Construction Path" />
<meta name="author" content="z1rp" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Tracing Functions Writing to The View-Projection Matrix" />
<meta property="og:description" content="Tracing Functions Writing to The View-Projection Matrix" />
<link rel="canonical" href="http://localhost:4000/ViewProj-Blog/part-4.1-tracing-matrix-construction/" />
<meta property="og:url" content="http://localhost:4000/ViewProj-Blog/part-4.1-tracing-matrix-construction/" />
<meta property="og:site_name" content="Reversing The ViewProjection Matrix" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-07-17T00:00:00+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Part 4.1: Tracing the Matrix Construction Path" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"z1rp"},"dateModified":"2025-07-17T00:00:00+05:30","datePublished":"2025-07-17T00:00:00+05:30","description":"Tracing Functions Writing to The View-Projection Matrix","headline":"Part 4.1: Tracing the Matrix Construction Path","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/ViewProj-Blog/part-4.1-tracing-matrix-construction/"},"url":"http://localhost:4000/ViewProj-Blog/part-4.1-tracing-matrix-construction/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/ViewProj-Blog/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/ViewProj-Blog/feed.xml" title="Reversing The ViewProjection Matrix" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/ViewProj-Blog/">Reversing The ViewProjection Matrix</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/ViewProj-Blog/">Index</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Part 4.1: Tracing the Matrix Construction Path</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2025-07-17T00:00:00+05:30" itemprop="datePublished">Jul 17, 2025
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h3 id="tracing-functions-writing-to-the-view-projection-matrix">Tracing Functions Writing to The View-Projection Matrix</h3>

<p>Lets start by observing which function writes to the View-Projection Matrix by clicking on the “Find out what writes this address” on the first element
of the View-Projection Matrix.</p>

<p><img src="/ViewProj-Blog/assets/images/part-4.1/find-what-writes-vpmatrix.png" alt="ESP-Image1" /></p>

<p>We have found 2 different functions that seem to write to this address.
<img src="/ViewProj-Blog/assets/images/part-4.1/found-what-writes-vpmatrix.png" alt="ESP-Image1" /></p>

<p>The first instruction seems to reference an address “VCRUNTIME140.memset+134:” and the second one reference’s “GhostOfTsushima.exe+9AA0AF:”.<br />
The second instruction intregiues me more so lets look at that one.<br />
<img src="/ViewProj-Blog/assets/images/part-4.1/9aa082-ins-asm-ce.png" alt="ESP-Image1" /></p>

<p>Here [rdi+0x5C0] is our static memory address of the view projection matrix and is getting written into by “xmm0”.</p>

<blockquote>
  <p>In x64 systems, xmm registers are part of the SSE (Streaming SIMD Extensions) register set. Each xmm register is 
128 bits wide, which makes them ideal for handling vectors, matrices, and other packed floating-point operations. Modern Games use 
SIMD (“Single instruction Multiple Data”) instructions using these registers to optimize performance when doing things like 
matrix math and transformations.</p>
</blockquote>

<p>Lets now see where “xmm0” gets its 4, 32bit float values from. In the instruction just above we see “xmm0” gets its value from<br />
“movups xmm0,[rax+00000240]” which means [rax+00000240] would be where it seems to copy the values from.</p>

<p><strong>lets see this entire function in ida before moving further</strong></p>

<p>lets “select current function” in cheat engine to get the function start address which is “GhostOfTsushima.exe+9AA040”.<br />
Lets put this in ida and see its pseudo-code.
<img src="/ViewProj-Blog/assets/images/part-4.1/ida-view-9aa082.png" alt="ESP-Image1" /></p>

<blockquote>
  <p>Don’t forget to rebase IDA to “0” before searching for the address in the function subview!<br />
Alternatively, you can calculate the offset between the Cheat Engine base and the IDA base manually using a calculator.</p>
</blockquote>

<p>While stepping through the function, I didn’t encounter many SIMD instructions like “mm_mul”, “mm_add_ps”, or “mm_shuffle_ps”.
Instead, it appears that the function is primarily copying matrices from dynamic memory into this static location,  possibly from a 
camera struct or a similar source.</p>


  </div><a class="u-url" href="/ViewProj-Blog/part-4.1-tracing-matrix-construction/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/ViewProj-Blog/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Reversing The ViewProjection Matrix</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">z1rp</li><li><a class="u-email" href="mailto:Zer0_1rp@proton.me">Zer0_1rp@proton.me</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Reverse Engineering the ViewProjection Pipeline in Ghost of Tsushima</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
