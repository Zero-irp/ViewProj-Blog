---
layout: post
title: "Part 1: Introduction"
date: 2025-07-17 00:00:00 +0530
permalink: /part-1-intro/
---

### ⚠️ Disclaimer:
The content on this blog is provided for educational and informational purposes only. I do not encourage, endorse, or support any illegal activity. 
Any techniques, tools, or concepts discussed are intended solely for learning, research, defensive security, or experimentation in safe, legal 
environments. Use this information responsibly and at your own risk. The author is not responsible for any misuse or legal consequences that may 
result from applying what’s written here.

### **How This Rabbit Hole Started:**

It all began when I was messing around with Ghost of Tsushima, trying to locate the View-Projection matrix to build a working world-to-screen (w2s) function. I eventually found it 
and it worked as intended. But while digging through memory, I came across several other interesting matrices. Two of them stood out: the Camera World Matrix and the Perspective 
Projection Matrix. I figured i could reconstruct the View-Projection matrix myself by multiplying the inverse of the camera world matrix with projection matrix the as most Direct-X games 
do. But the result didn’t match the actual View-Projection matrix.
Curious, I started tracing the functions that write to the View-Projection matrix using IDA Pro, ReClass, and Cheat Engine. That's when I discovered the engine was building 
the matrix in a non-standard way, or at least, a way that was unfamiliar to me and different from the basic graphics pipeline I was expecting.

### **Prerequisites**
- Understanding the assembly language (x86-64)
- Basic Reverse Engineering Skills
- Intermediate knowledge in C++ 
- Windows API Familiarity
- Linear algebra
> I assume you already understand the linear-algebra concepts used throughout: vectors, matrices (4×4), homogeneous coordinates (Vec4(x,y,z,1)), dot/cross products, matrix × vector, and the perspective divide

### **What Are we Trying to achieve?**

In this write-up series, we’re going to reverse engineer how *Ghost of Tsushima* constructs its **View-Projection matrix**, the thing that turns 3D world positions into 2D screen 
coordinates. This is super important for stuff like ESP overlays (you can’t draw a box around an enemy if you don’t know where they are on screen).

We’ll be reverse engineering the game’s rendering pipeline using tools like IDA Pro, breaking down how the View-Projection matrix is built step by step including all the weird 
SIMD instructions it uses. The goal is to figure out where it's stored, how it's constructed, and how it's used in the game.

### **What is an ESP?**

ESP stands for _Extra-Sensory Perception_. In game hacking, it refers to any feature that shows you information you normally wouldn’t be able to see, stuff the game doesn’t intend to show.
For example, an ESP might let you:
- See players through walls
- Know their exact health
- Track what's in their inventory
- Spot hidden loot, traps etc...

This gives a huge unfair advantage over others.

### **Write-Up Outline:**

- **[Part 1: Introduction](../part-1-intro/)**
  - [How This Rabbit Hole Started](../part-1-intro/#how-this-rabbit-hole-started)
  - [Prerequisites](../part-1-intro/#prerequisites)
  - [What Are we Trying to achieve?](../part-1-intro/#what-are-we-trying-to-achieve)
  - [What is an ESP?](../part-1-intro/#what-is-an-esp)

- **[Part 2.1: View Matrix](../part-2.1-view-matrix/)**
  - [Introduction](../part-2.1-view-matrix/#introduction)
  - [Camera World Matrix](../part-2.1-view-matrix/#camera-world-matrix)
  - [What is a View-Matrix?](../part-2.1-view-matrix/#what-is-a-view-matrix)
  - [Layout Of the View Matrix](../part-2.1-view-matrix/#layout-of-the-view-matrix)
  - [Breaking Down the View Matrix Vectors](../part-2.1-view-matrix/#breaking-down-the-view-matrix-vectors)
  - [Orthogonality and Relations:- (Optional / Good to know)](../part-2.1-view-matrix/#orthogonality-and-relations--optionalgood-to-know)
  - [Model Matrix (Optional / Good to know)](../part-2.1-view-matrix/#model-matrix--optionalgood-to-know)

- **[Part 2.2: Projection Matrix](../part-2.2-projection-matrix/)**
  - [What is the Projection Matrix?](../part-2.2-projection-matrix/#what-is-the-projection-matrix)
  - [What the Projection Matrix Does](../part-2.2-projection-matrix/#what-the-projection-matrix-does)
  - [Layout of the Perspective Projection Matrix](../part-2.2-projection-matrix/#layout-of-the-perspective-projection-matrix)
  - [Relationship Between Horizontal and Vertical FOV](../part-2.2-projection-matrix/#relationship-between-horizontal-and-vertical-fov)
  - [What is Reverse Z?](../part-2.2-projection-matrix/#what-is-reverse-z)
  - [Layout of Reverse Z Projection Matrix](../part-2.2-projection-matrix/#layout-of-reverse-z-projection-matrix)

- **[Part 2.3: View Projection Matrix](../part-2.3-View-Projection-matrix/)**
  - [What is the View-Projection Matrix?](../part-2.3-View-Projection-matrix/#what-is-the-view-projection-matrix)

- **[Part 3: Finding & Reversing Matrices](../part-3-finding-and-reversing-matrices/)**
  - [How We Search for Matrices in Memory](../part-3-finding-and-reversing-matrices/#how-we-search-for-matrices-in-memory)
  - [Searching for Matrices in Ghost of Tsushima](../part-3-finding-and-reversing-matrices/#searching-for-matrices-in-ghost-of-tsushima)
  - [Confirmation of the View and Camera World Matrices](../part-3-finding-and-reversing-matrices/#confirmation-of-the-view-and-camera-world-matrices)
  - [Looking at other matrices (Projection, VP etc)](../part-3-finding-and-reversing-matrices/#looking-at-other-matrices)
  - [Other ways to get the VP matrix](../part-3-finding-and-reversing-matrices/#other-ways-to-get-the-vp-matrix)
  - [Trying to Rebuild the View-Projection Matrix](../part-3-finding-and-reversing-matrices/#trying-to-rebuild-the-view-projection-matrix)

- **[Part 4.1: Tracing the Matrix Construction Path](../part-4.1-tracing-matrix-construction/)**
  - [Tracing Functions Writing to The View-Projection Matrix](../part-4.1-tracing-matrix-construction/#tracing-functions-writing-to-the-view-projection-matrix)
  - [Windows Calling Conventions (ABI)](../part-4.1-tracing-matrix-construction/#windows-calling-conventions-abi)
  - [BreakPoints, Stacktrace etc](../part-4.1-tracing-matrix-construction/#breakpoint--stacktrace)
  - [Looking at functions in IDA PRO](../part-4.1-tracing-matrix-construction/#ida-code)
  - [View Matrix Recovery through Matrix Algebra](../part-4.1-tracing-matrix-construction/#why-not-just-invert-it)

- **[Part 4.2: Reversing SIMD Instructions for Matrix Math](../part-4.2-reversing-simd-instrustions/)**
  - [Reversing SIMD instructions](../part-4.2-reversing-simd-instrustions/#reversing-simd-instructions)
  - [Masking Out w with SIMD (Theory)](../part-4.2-reversing-simd-instrustions/#masking-out-w-with-simd-theory)
  - [_mm_shuffle_ps (Theory)](../part-4.2-reversing-simd-instrustions/#_mm_shuffle_ps-theory)
  - [Negating a Vector with SIMD (Theory)](../part-4.2-reversing-simd-instrustions/#negating-a-vector-with-simd-theory)
  - [_mm_unpack (Theory)](../part-4.2-reversing-simd-instrustions/#_mm_unpack-theory)
  - [Transposing and Shuffling Intermediate Vectors (Theory)](../part-4.2-reversing-simd-instrustions/#transposing-and-shuffling-intermediate-vectors-theory)
  - [Manual Matrix Reconstruction from SIMD Operations (Example)](../part-4.2-reversing-simd-instrustions/#manual-matrix-reconstruction-from-simd-operations-example)
  - [SIMD-Based Vec4 × 4x4 Matrix Multiplication (Theory)](../part-4.2-reversing-simd-instrustions/#simd-based-vec4--4x4-matrix-multiplication-theory)
  - [Comparing Constructed Matrix with Camera World Matrix:](../part-4.2-reversing-simd-instrustions/#comparing-constructed-matrix-with-camera-world-matrix)
  - [Fast inverse for orthonormal Matrices](../part-4.2-reversing-simd-instrustions/#fast-inverse-for-orthonormal-matrices)
  - [Continuation of Manual Matrix Reconstruction (Example)](../part-4.2-reversing-simd-instrustions/#continuaton-of-manual-matrix-reconstruction-example)
  - [Confirmation Of VP Matrix from Manual Construction](../part-4.2-reversing-simd-instrustions/#confirmation-of-vp-matrix)

- **[Part 4.3: Completing the View-Projection Matrix](../part-4.3-completing-view-proj-matrix/)**
  - [Matrix Loading into Memory](../part-4.3-completing-view-proj-matrix/#matrix-loading-into-memory)
  - [Making sense](../part-4.3-completing-view-proj-matrix/#making-sense)
  - [Many Redundant SIMD math functions](../part-4.3-completing-view-proj-matrix/#another-redundant-simd-math-function)
  - [Negated Camera position Multiplication with View-Projection Matrix](../part-4.3-completing-view-proj-matrix/#negated-camera-position-multiplication-with-viewprojection-matrix)
  - [Even More redundant SIMD operations](../part-4.3-completing-view-proj-matrix/#even-more-redundant-simd-operations)
  - [Biggest reduction in SIMD operations](../part-4.3-completing-view-proj-matrix/#biggest-reduction-in-simd-operations)
  - [Continuation of Manual Matrix Reconstruction](../part-4.3-completing-view-proj-matrix/#continuaton-of-manual-matrix-reconstruction)
  - [The View-Projection Matrix - Fully Reversed](../part-4.3-completing-view-proj-matrix/#the-viewprojection-matrix---fully-reversed)
  - [Final Verification](../part-4.3-completing-view-proj-matrix/#final-verification)
  - [Camera World Matrix Does Not Match?](../part-4.3-completing-view-proj-matrix/#camera-world-matrix-does-not-match)
  - [Completion of VP matrix construction from SIMD operations](../part-4.3-completing-view-proj-matrix/#completion-of-vp-matrix-construction-from-simd-operations)

- **[Part 4.4: Optimizing Redundant SIMD Instructions](../part-4.4-optimizing-redundant-simd-instructions/)**
  - [Finding Assembly responsible for this function](../part-4.4-optimizing-redundant-simd-instructions/#finding-assembly-responsible-for-this-function)
  - [Nopping Instructions](../part-4.4-optimizing-redundant-simd-instructions/#nopping-instructions)
  - [Result of game running smoothly](../part-4.4-optimizing-redundant-simd-instructions/#result)

- **[Part 4.5: Detour Hooking to Optimize SIMD Operations](../part-4.5-detour-hooking-simd-operations/)**
  - [What is detour Hooking?](../part-4.5-detour-hooking-simd-operations/#what-is-detour-hooking)
  - [The approach](../part-4.5-detour-hooking-simd-operations/#heres-the-approach)
  - [5 Byte Jmp hook vs 12 Byte Jmp hook](../part-4.5-detour-hooking-simd-operations/#5-byte-jmp-hook-vs-12-byte-jmp-hook)
  - [Writing our hook](../part-4.5-detour-hooking-simd-operations/#writing-our-hook)
  - [Code Explanation:](../part-4.5-detour-hooking-simd-operations/#code-explanation)
  - [Executing our hook](../part-4.5-detour-hooking-simd-operations/#executing-our-hook)
  - [Observations in game and memory](../part-4.5-detour-hooking-simd-operations/#observations-in-game-and-memory)

- **[Part 5: Trampoline Hooking to Capture Entity Positions](../part-5-trampoline-hooking/)**
  - [What is Trampoline Hooking?](../part-5-trampoline-hooking/#what-is-trampoline-hooking)
  - [The Plan](../part-5-trampoline-hooking/#the-plan)
  - [The Hook](../part-5-trampoline-hooking/#the-hook)
  - [Setting Up Memory for the Trampoline](../part-5-trampoline-hooking/#setting-up-memory-for-the-trampoline)
  - [Hooking the Z-Axis Instruction](../part-5-trampoline-hooking/#hooking-the-z-axis-instruction)
  - [Writing the Trampoline](../part-5-trampoline-hooking/#writing-the-trampoline)
  - [Capturing & Storing Entities](../part-5-trampoline-hooking/#capturing--storing-entities)

- **[Part 6: World To Screen Explanation And Code](../part-6-w2s/)**
  - [What “World to Screen” Means](../part-6-w2s/#what-world-to-screen-means)
  - [World to Screen Code Explanation](../part-6-w2s/#world-to-screen-code-explanation)
	- [World Space → Clip Space](../part-6-w2s/../part-6-w2s/#world-space--clip-space)
	- [Clip Check](../part-6-w2s/../part-6-w2s/#clip-check)
	- [Clip Space → NDC](../part-6-w2s/../part-6-w2s/#clip-space--ndc)
	- [NDC → Screen Space](../part-6-w2s/../part-6-w2s/#ndc--screen-space)
  - [Summary of the Transformation Pipeline](../part-6-w2s/#summary-of-the-transformation-pipeline)
  - [TL;DR of w2s](../part-6-w2s/#tldr-of-w2s)

- **[Part 7: Final ESP with ImGui](../part-7-final-esp/)**
  - [Introduction](../part-7-final-esp/#introduction)
  - [Entire Code Explanation](../part-7-final-esp/#code-explanation)
    - Step 1: Reading Entities and Their Data
    - Step 2: Filtering Unique and Relevant Entities
    - Step 3: Toggle ESP
    - Step 4: Loop Through Entities and Get Screen Positions
    - Step 5: Drawing Snaplines Using ImGui
    - TL;DR of the Code Flow
  - [Closing Thoughts](../part-7-final-esp/#closing-thoughts)

**What it should look like:**

![ESP-Image1](/ViewProj-Blog/assets/images/part-1/GotEsp-1.png)
---
![ESP-Image2](/ViewProj-Blog/assets/images/part-1/GotEsp-2.png)

Snippets of what we will be working with:

**IDA PRO:**
![IDA-screenshot](/ViewProj-Blog/assets/images/part-1/ida-view.png)

**Cheat Engine:**
![CheatEngine-screenshot](/ViewProj-Blog/assets/images/part-1/CheatEngine-view.png)

**Visual Studio:**
![VisualStudio-screenshot](/ViewProj-Blog/assets/images/part-1/VisualStudio-view.png)

**Reclass:**
![Reclass-screenshot](/ViewProj-Blog/assets/images/part-1/Reclass-view.png)

This blog series is just me sharing what I’ve figured out so far while reverse engineering _Ghost of Tsushima_. There’s always more to understand, and I’m sure some things I say might not be 100% perfect, so if you spot something I missed, or you have better insights, I’d really love to hear from you.

Feel free to reach out to me:
- Discord: zer0_1rp
- Email: [Zer0_1rp@proton.me](mailto:Zer0_1rp@proton.me)
- Reddit: u/zer0_1rp
- UC: z1rp
